#include <assert.h>
#include "./../include/arithmetic.h"

word compareArrays(word *ar1, word *ar2) {
    word i;
    
    for (i = 0; i < SIZE; i++)
        if (ar1[i] != ar2[i])
            return 0;
    
    return 1;
}

void test_mod_add(word *nbTest) {
    word result[SIZE];

    word N[SIZE] = {
        0xe87c0891, 0xedefbacf, 0xbe75c544, 0xb29e5e19, 0x860c5ab6, 0xf1e491df,
        0xc8d459fe, 0xc811c225, 0xc4870bec, 0x60af8542, 0xec8422a1, 0xa5d7ac12,
        0x5e3ad006, 0xc99e51d9, 0xfb0db87f, 0xbf7d0d0c, 0x51777580, 0x77f88d79,
        0x7437df95, 0x96787032, 0x38cfc8ca, 0xba87a2b5, 0x1de9b64c, 0x56905a55,
        0xdf056077, 0x02edd0b8, 0x3a8af36b, 0x631da6cb, 0xde2f29a8, 0x3982f519,
        0xb51e533c, 0xddbe8494};
    word a[SIZE] = {
        0x40ea3679, 0x13b7e95f, 0x961bf864, 0xd09d0a0a, 0x72ed6a7b, 0x2ac4de5b,
        0x8b9ebd95, 0xcf2cdf20, 0x9b729071, 0x39e2ff0a, 0x8f04fa45, 0x9b16fe5a,
        0x79366180, 0xff9d8257, 0x1060d96f, 0x3de121ba, 0xb30033c8, 0xaf5943cd,
        0x65703523, 0xb2630421, 0x6d0e6319, 0xc99c9aa4, 0x45e02225, 0xac1523c7,
        0x50471970, 0xd4cddec8, 0x7489978a, 0xa698959d, 0x4230dc65, 0xba17abc1,
        0x15b5dc9b, 0xaca3a8e7};
    word b[SIZE] = {
        0x283c7403, 0x4357f769, 0xab14c306, 0x4ad81b52, 0xb1fc5913, 0x35c9dfe9,
        0x7c1d80e8, 0x54e6e780, 0xe89ae1e9, 0x8501757c, 0xab3da57b, 0xecd1aa87,
        0xcebe9311, 0x3a67a0e9, 0xce9c9a13, 0x1df20725, 0x6bf1e858, 0xda4701c3,
        0xcd8b2db7, 0xd542dbd0, 0xb7f8f516, 0xdc353e6f, 0x8f9bbcea, 0x5f3dab0b,
        0x3e9ebf0f, 0xb1965516, 0x6ecff295, 0x40591cbb, 0x089cdff2, 0x95401932,
        0xc6d31d88, 0xa4bc1304};
    word c[SIZE] = {
        0xc6c3c93a, 0x7051794e, 0x000ca427, 0xeafa3218, 0x45693a60, 0xeceb5ca2,
        0x91af509c, 0x5127beff, 0x36746c50, 0x13117383, 0x16fcd75e, 0x79023bd8,
        0xeea9e87e, 0x8b9f6349, 0xc89ad6fe, 0x2004481b, 0xed4a0343, 0x6512fdff,
        0x29ade3a6, 0xa1a09e57, 0x061b5640, 0xfccfe580, 0x85d3881a, 0x7cdebf3c,
        0xf8895370, 0xb36d5fe7, 0xb250463e, 0x6de85c82, 0x0bf498b0, 0xaf834d0a,
        0x2e3b67b7, 0x1ccc03f7};
    word expected1[SIZE] = {
        0x80aaa1eb, 0x692025f8, 0x82baf625, 0x68d6c743, 0x9edd68d8, 0x6eaa2c65,
        0x3ee7e47e, 0x5c02047b, 0xbf86666e, 0x5e34ef44, 0x4dbe7d1f, 0xe210fccf,
        0xe9ba248b, 0x7066d167, 0xe3efbb03, 0x9c561bd2, 0xcd7aa69f, 0x11a7b817,
        0xbec38346, 0xf12d6fbf, 0xec378f65, 0xeb4a365e, 0xb79228c3, 0xb4c2747d,
        0xafe07808, 0x83766325, 0xa8ce96b5, 0x83d40b8d, 0x6c9e92af, 0x15d4cfd9,
        0x276aa6e8, 0x73a13757};
    word expected2[SIZE] = {
        0x07adffb3, 0x840962ae, 0x96289c8b, 0xbb973c22, 0xb856a4dc, 0x17b03afd,
        0x1d4e0e32, 0x20549e20, 0xd1e6fcc2, 0x4cf4728d, 0xa601d1a3, 0x14193a32,
        0x67e049ff, 0x8b3ce5a1, 0xd8fbb06e, 0x5de569d5, 0xa04a370b, 0x146c41cd,
        0x8f1e18ca, 0x5403a278, 0x7329b95a, 0xc66c8024, 0xcbb3aa40, 0x28f3e303,
        0x48d06ce1, 0x883b3eb0, 0x26d9ddc9, 0x1480f220, 0x4e257516, 0x699af8cb,
        0x43f14453, 0xc96facde};

    mod_add(a, b, N, result);

    printf("%x", result[0]);
    assert(compareArrays(expected1, result));
    printf("Test %u - Modular addition passed.", (*nbTest)++);

    mod_add(a, c, N, result);

    assert(compareArrays(expected2, result));
    printf("Test %u - Modular addition passed.", (*nbTest)++);
}

void test_mod_sub(word *nbTest) {
    word result[SIZE];

    word N[SIZE] = {
        0xe87c0891, 0xedefbacf, 0xbe75c544, 0xb29e5e19, 0x860c5ab6, 0xf1e491df,
        0xc8d459fe, 0xc811c225, 0xc4870bec, 0x60af8542, 0xec8422a1, 0xa5d7ac12,
        0x5e3ad006, 0xc99e51d9, 0xfb0db87f, 0xbf7d0d0c, 0x51777580, 0x77f88d79,
        0x7437df95, 0x96787032, 0x38cfc8ca, 0xba87a2b5, 0x1de9b64c, 0x56905a55,
        0xdf056077, 0x02edd0b8, 0x3a8af36b, 0x631da6cb, 0xde2f29a8, 0x3982f519,
        0xb51e533c, 0xddbe8494};
    word a[SIZE] = {
        0x40ea3679, 0x13b7e95f, 0x961bf864, 0xd09d0a0a, 0x72ed6a7b, 0x2ac4de5b,
        0x8b9ebd95, 0xcf2cdf20, 0x9b729071, 0x39e2ff0a, 0x8f04fa45, 0x9b16fe5a,
        0x79366180, 0xff9d8257, 0x1060d96f, 0x3de121ba, 0xb30033c8, 0xaf5943cd,
        0x65703523, 0xb2630421, 0x6d0e6319, 0xc99c9aa4, 0x45e02225, 0xac1523c7,
        0x50471970, 0xd4cddec8, 0x7489978a, 0xa698959d, 0x4230dc65, 0xba17abc1,
        0x15b5dc9b, 0xaca3a8e7};
    word b[SIZE] = {
        0x283c7403, 0x4357f769, 0xab14c306, 0x4ad81b52, 0xb1fc5913, 0x35c9dfe9,
        0x7c1d80e8, 0x54e6e780, 0xe89ae1e9, 0x8501757c, 0xab3da57b, 0xecd1aa87,
        0xcebe9311, 0x3a67a0e9, 0xce9c9a13, 0x1df20725, 0x6bf1e858, 0xda4701c3,
        0xcd8b2db7, 0xd542dbd0, 0xb7f8f516, 0xdc353e6f, 0x8f9bbcea, 0x5f3dab0b,
        0x3e9ebf0f, 0xb1965516, 0x6ecff295, 0x40591cbb, 0x089cdff2, 0x95401932,
        0xc6d31d88, 0xa4bc1304};
    word c[SIZE] = {
        0xc6c3c93a, 0x7051794e, 0x000ca427, 0xeafa3218, 0x45693a60, 0xeceb5ca2,
        0x91af509c, 0x5127beff, 0x36746c50, 0x13117383, 0x16fcd75e, 0x79023bd8,
        0xeea9e87e, 0x8b9f6349, 0xc89ad6fe, 0x2004481b, 0xed4a0343, 0x6512fdff,
        0x29ade3a6, 0xa1a09e57, 0x061b5640, 0xfccfe580, 0x85d3881a, 0x7cdebf3c,
        0xf8895370, 0xb36d5fe7, 0xb250463e, 0x6de85c82, 0x0bf498b0, 0xaf834d0a,
        0x2e3b67b7, 0x1ccc03f7};
    word expected1[SIZE] = {
        0x80aaa1eb, 0x692025f8, 0x82baf625, 0x68d6c743, 0x9edd68d8, 0x6eaa2c65,
        0x3ee7e47e, 0x5c02047b, 0xbf86666e, 0x5e34ef44, 0x4dbe7d1f, 0xe210fccf,
        0xe9ba248b, 0x7066d167, 0xe3efbb03, 0x9c561bd2, 0xcd7aa69f, 0x11a7b817,
        0xbec38346, 0xf12d6fbf, 0xec378f65, 0xeb4a365e, 0xb79228c3, 0xb4c2747d,
        0xafe07808, 0x83766325, 0xa8ce96b5, 0x83d40b8d, 0x6c9e92af, 0x15d4cfd9,
        0x276aa6e8, 0x73a13757};
    word expected2[SIZE] = {
        0x87035dc8, 0x1ae93cb5, 0x136da666, 0x52c074df, 0x19793c04, 0xa9060e98,
        0xde6629b3, 0xc45299a4, 0x12609653, 0xeebf8349, 0x58435483, 0x32083d63,
        0x7e262573, 0x1ad61439, 0xf50bf56b, 0xc18f4e02, 0xd2cf906b, 0x02c489b5,
        0xd05a9584, 0x62d632b8, 0x86f229f4, 0xdb2249c5, 0x1421817c, 0x74316e86,
        0x98eff4d8, 0x04c4db8a, 0x7e0b4714, 0x90ace692, 0xe186e266, 0x53c628f1,
        0x1c869d6b, 0x55ce7587};

    mod_sub(a, b, N, result);

    assert(compareArrays(expected1, result));
    printf("Test %u - Modular addition passed.", (*nbTest)++);

    mod_sub(c, b, N, result);

    assert(compareArrays(expected2, result));
    printf("Test %u - Modular addition passed.", (*nbTest)++);
}

void test_montgomery(word *nbTest) {
    word i;
    word res[SIZE + 1];

    word a[SIZE] = {
        0xa2e47eba, 0xdb5e3e7d, 0x5fd9a7cb, 0x9e7a37c3, 0x4dc37416, 0x834fe315,
        0x0080dbac, 0x47280a4d, 0x722dc3dd, 0x7f0ca6f4, 0x7f0da3db, 0xfc20cbb9,
        0xb749699e, 0xc5abc925, 0x8bc67669, 0x23a30d3f, 0xffe44e1c, 0xdb22d6ee,
        0x5dc3d3b3, 0xfe7e980d, 0x894075d2, 0xdeabe7c4, 0x58042c3b, 0x1cc18107,
        0xf0abb2e1, 0x7bd31dc0, 0x72355db9, 0xf55a0178, 0x99f5d831, 0x12ccb47a,
        0x44eef089, 0x81bf5831};
    word b[SIZE] = {
        0xe47d092a, 0xd7615ed9, 0xa8aff661, 0xc3d7bb8c, 0x2d22b31c, 0x5050b808,
        0xb0bc44bb, 0x93e46f4f, 0xac0332e5, 0x81ad7f85, 0x23de9197, 0x4b35f0a2,
        0x6303744a, 0x615740bf, 0x54ebbaef, 0xf36273c2, 0xaf0d1080, 0x4740c9d6,
        0x458e6699, 0xaaa1040b, 0x614df162, 0xaf7fe30d, 0xac73e3ed, 0x49204145,
        0x1653523c, 0x5ee4f3b1, 0x2b3f4339, 0x5b9a2426, 0x62e3ffb3, 0xf4c32df1,
        0x94f2db82, 0x80deb209};
    word n[SIZE] = {
        0xb2e52d11, 0x8f850a5f, 0x08edfb0c, 0x4f02a1ac, 0xdd070636, 0x6c59cfc8,
        0x16a40db7, 0x85bba009, 0x598eba07, 0x5d0fa3cc, 0x32bc6fb5, 0x4aa27cd0,
        0x0928454e, 0x027d3081, 0xd1caec35, 0xa98e4223, 0x533983de, 0x36370bb4,
        0xe8b0b4c6, 0xfe3655ab, 0x27a4a51e, 0xb403c449, 0xa679cf3b, 0xc1fc4391,
        0x884e5080, 0xa65d4d30, 0xcd90ed67, 0x55fcb457, 0x989d6f4c, 0x0303d70e,
        0x9a09328e, 0x82260dd0};
    word n_prime[SIZE] = {
        0xfb5c9c0f, 0xd3cbec85, 0x3a126c50, 0x0f85259a, 0xb93b900a, 0x89feafbe,
        0x30847469, 0x0a87f885, 0x9d5bfa86, 0xec1adae0, 0x448a3dac, 0xa7194e08,
        0x61c37198, 0xd5eff8a8, 0xf96efef1, 0x473d83aa, 0xe7c048dd, 0xb1893377,
        0xc843e910, 0xcd3b86d2, 0x2119b9dd, 0x6caed27a, 0x7ebcc873, 0x2019cd09,
        0x240e3495, 0x040754fb, 0xdfef2830, 0x32a287d7, 0x8e79f7e4, 0x3daeb7e0,
        0xbeaeac00, 0x376725cd};
    word sol[SIZE] = {
        0x919af36d, 0x201c5a15, 0x763debb4, 0x54b92abd, 0xc3d09af8, 0x0269454a,
        0x35a42e09, 0x1149a6e6, 0x381cfa5b, 0x61b91a68, 0x7180faf5, 0x8c7536c6,
        0x0368f56d, 0x0ce9c2ab, 0xd6180f19, 0x0cf8b5ac, 0x62ca69e8, 0x8789e2ec,
        0x080ca2ea, 0x4dea79c7, 0xf3b4499d, 0xbae3cd24, 0x148e24af, 0x83e7cc56,
        0x22548763, 0x1e0f13bf, 0xc6b26d8e, 0xfc9c092d, 0x8fa70ce2, 0xb5098439,
        0x9f7d1f55, 0x50a9e0c6};

    montMul(a, b, n, n_prime, res);

    for (i = 0; i < SIZE; i++)
        assert(sol[i] == res[i]);
    printf("Test %u - Modular addition passed.", (*nbTest)++);
}

int main(int argc, char const *argv[])
{
    word nbTest = 1;

    test_mod_add(&nbTest);
    test_mod_sub(&nbTest);
    test_montgomery(&nbTest);

    return 0;
}